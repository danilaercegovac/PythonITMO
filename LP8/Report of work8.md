# Лабораторная работа №8  
## Клиент-серверное приложение на Python (HTTPServer, MVC, Jinja2)

---

## 1. Цель работы

Целью данной лабораторной работы является разработка простого клиент-серверного веб-приложения на языке Python без использования серверных фреймворков.

В ходе выполнения лабораторной работы были решены следующие задачи:
- создание HTTP-сервера с использованием модуля `HTTPServer`;
- реализация маршрутизации HTTP-запросов;
- применение шаблонизатора Jinja2 для отображения HTML-страниц;
- разработка моделей предметной области с использованием геттеров и сеттеров;
- структурирование проекта в соответствии с архитектурой MVC;
- получение актуальных курсов валют с помощью функции `get_currencies`;
- реализация подписки пользователей на валюты;
- создание автотестов для моделей, контроллера и шаблонов.

---

## 2. Описание предметной области

Приложение предназначено для отображения информации о пользователях и курсах валют, а также управления подписками пользователей на выбранные валюты.

### Модели предметной области:

- **Author** — автор приложения  
  - `name` — имя автора  
  - `group` — учебная группа  

- **App** — информация о приложении  
  - `name` — название приложения  
  - `version` — версия  
  - `author` — объект класса `Author`  

- **User** — пользователь приложения  
  - `id` — уникальный идентификатор  
  - `name` — имя пользователя  

- **Currency** — валюта  
  - `id` — уникальный идентификатор валюты  
  - `num_code` — числовой код  
  - `char_code` — символьный код  
  - `name` — название валюты  
  - `value` — курс валюты  
  - `nominal` — номинал  

- **UserCurrency** — связь между пользователем и валютой  
  - `user` — объект `User`  
  - `currency` — объект `Currency`  

### Связи:
- Один пользователь может быть подписан на несколько валют.
- Приложение имеет одного автора.

---

## 3. Структура проекта

models/

    author.py # Модель автора
    app.py # Модель приложения
    user.py # Модель пользователя    
    currency.py # Модель валюты    
    user_currency.py # Связь пользователь–валюта
    
templates/

    index.html # Главная страница
    users.html # Список пользователей
    user.html # Страница пользователя
    currencies.html # Курсы валют
    author.html # Информация об авторе

utils/

    currencies_api.py # Функция get_currencies

tests/

    test_models.py # Тесты моделей
    test_controller.py # Тесты контроллера
    test_templates.py # Тесты шаблонов
    Testing8LPpythonGet_currenciesXML.py # Тесты get_currencies

myapp.py - HTTP-сервер и контроллер

screenshots/

    main_page.png # Скриншот главной страницы
    author_page.png # Скриншот author страницы
    user_page.png # Скриншот user страницы
    users_page.png # Скриншот users страницы
    userid1_page.png # Скриншот userid1 страницы
    currencies_page.png # Скриншот currencies страницы


## 4. Описание реализации

### 4.1 Реализация моделей

Все модели реализованы в виде классов Python.  
Для каждого атрибута используются:
- приватные поля;
- геттеры и сеттеры (`@property`);
- проверка корректности данных при установке значений;
- выброс исключений `ValueError` и `TypeError` при некорректных данных.

Такой подход предотвращает создание объектов в некорректном состоянии.

---

### 4.2 Реализация маршрутов и обработки запросов

Контроллер реализован с использованием класса `BaseHTTPRequestHandler`.

Маршрутизация выполняется на основе URL-пути:
- `/` — главная страница приложения;
- `/users` — список пользователей;
- `/user?id=...` — страница конкретного пользователя;
- `/currencies` — страница курсов валют;
- `/author` — информация об авторе.

Для каждого маршрута реализован отдельный метод рендеринга HTML-страницы.

---

### 4.3 Использование шаблонизатора Jinja2

Для генерации HTML используется шаблонизатор **Jinja2**.

Инициализация окружения выполняется следующим образом:
- создаётся объект `Environment`;
- указывается каталог с шаблонами (`templates`);
- шаблоны загружаются с помощью `FileSystemLoader`.

Данные передаются в шаблоны через метод `render`, что позволяет:
- использовать циклы `{% for %}`;
- использовать условия `{% if %}`;
- динамически формировать HTML-контент.

---

### 4.4 Интеграция функции get_currencies

Функция `get_currencies` используется для получения актуальных курсов валют по символьным кодам.

Алгоритм работы:
1. Из списка валют формируется список символьных кодов.
2. Вызывается функция `get_currencies`.
3. Полученные значения курсов обновляют объекты `Currency`.
4. Обновлённые данные передаются в шаблон.

---

## 5. Примеры работы приложения (скриншоты в папке screenshots)

### 5.1 Главная страница `/`
Отображает название приложения, версию и автора.

### 5.2 Страница `/users`
Содержит список пользователей с ссылками на их страницы.

### 5.3 Страница `/user?id=...`
Отображает информацию о выбранном пользователе и список валют, на которые он подписан.

### 5.4 Страница `/currencies`
Отображает список валют и их текущие курсы.

### 5.4 Страница `/author`
Отображает информацию об авторе.

---

## 6. Тестирование

### 6.1 Тестирование моделей

Проверяется:
- корректная работа геттеров и сеттеров;
- выброс исключений при некорректных данных;
- невозможность создания объектов в неверном состоянии.

### 6.2 Тестирование контроллера

Проверяется:
- корректная обработка маршрутов `/`, `/users`, `/currencies`;
- корректная обработка query-параметров (`/user?id=...`);
- возврат HTTP-статуса 200;
- корректное формирование HTML-ответов.

### 6.3 Тестирование шаблонов

Проверяется:
- передача переменных в шаблоны;
- корректная работа циклов;
- корректная работа условных конструкций;
- рендеринг всех HTML-шаблонов.

---

## 7. Выводы

### 7.1 Возникшие проблемы

Наибольшую сложность вызвали:
- реализация обработки query-параметров;
- корректная передача данных в шаблоны;
- тестирование HTTP-сервера без использования фреймворков;
- реализация метода `render_user`, требующий дополнительной фильтрации данных.

Новые темы, вызвавшие интерес и трудность:
- настройка структуры MVC;
- работа с HTTP-заголовками;
- обработка кодировки UTF-8;
- тестирование серверной логики.

---

### 7.2 Применение архитектуры MVC

Архитектура MVC была успешно применена:
- **Model** — классы в папке `models`;
- **View** — HTML-шаблоны Jinja2;
- **Controller** — HTTP-обработчик в `myapp.py`.

---

### 7.3 Полученные знания

В ходе лабораторной работы были получены навыки:
- работы с `HTTPServer`;
- реализации серверной логики без фреймворков;
- использования Jinja2;
- интеграции внешних API;
- написания автотестов;
- проектирования приложений по MVC.

Лабораторная работа позволила глубже понять принципы работы веб-приложений на низком уровне.
